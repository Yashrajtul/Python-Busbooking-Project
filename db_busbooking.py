import sqlite3
con = sqlite3.connect('Busbooking.db')
cur = con.cursor()

"""
cur.execute('DROP TABLE BUS;')
cur.execute('''
CREATE TABLE IF NOT EXISTS BUS(
    BID INT NOT NULL,
    TYPE VARCHAR(15) NOT NULL,
    CAPACITY INT NOT NULL,
    FARE INT NOT NULL,
    OPID INT NOT NULL,
    ROUTEID INT NOT NULL,
    PRIMARY KEY(BID),
    FOREIGN KEY(OPID) REFERENCES OPERATOR(OPID),
    FOREIGN KEY(ROUTEID) REFERENCES ROUTE(ROUTEID)
)''')
cur.execute("INSERT INTO BUS VALUES (1,'AC 2x2',30,1000,1,1),(2,'AC 3x2',50,800,1,2),(3,'Non AC 2x2',30,600,1,3),(4,'Non AC 2x2',30,600,1,4)")
#cur.execute('SELECT * FROM BUS')

cur.execute('DROP TABLE OPERATOR;')
cur.execute('''
CREATE TABLE IF NOT EXISTS OPERATOR (
    OPID INT NOT NULL,
    NAME VARCHAR(25) NOT NULL,
    ADDRESS VARCHAR(40) NOT NULL,
    PHONE INT NOT NULL,
    EMAIL VARCHAR(25) NOT NULL,
    PRIMARY KEY(OPID)
)''')
cur.execute("INSERT INTO OPERATOR VALUES (1,'Kamla','AB road Guna',12345,'kamlabus@gmail.com'),(2,'Rayeen','AB road Guna',12346,'rayeen@gmail.com'),(3,'Kalyani','Hauj Khas Delhi',12347,'kalyani@gmail.com'),(4,'Mahakaal','AB road Jhansi',12348,'mahakaal@gmail.com')")
#cur.execute('SELECT * FROM OPERATOR')
"""
"""
cur.execute('DROP TABLE ROUTE;')
cur.execute('''
CREATE TABLE IF NOT EXISTS ROUTE(
    ROUTEID INT NOT NULL,
    SID INT NOT NULL,
    STATION_NAME VARCHAR(15) NOT NULL,
    PRIMARY KEY(ROUTEID,SID)       
)''')
cur.execute("INSERT INTO ROUTE VALUES (1,1,'Guna'),(1,2,'JP College'),(1,3,'Binagunj'),(1,4,'Biora'),(1,5,'Bhopal')")
cur.execute("INSERT INTO ROUTE VALUES (2,1,'Bhopal'),(2,2,'Biora'),(2,3,'Binagunj'),(2,4,'JP College'),(2,5,'Guna')")
"""
"""
cur.execute('DROP TABLE RUNS;')
cur.execute('''
CREATE TABLE IF NOT EXISTS RUNS (
    BUSID INT NOT NULL,
    RUNSDATE DATE NOT NULL,
    SEATAVAIL INT NOT NULL
)''')
cur.execute("INSERT INTO RUNS VALUES (1, '2022-09-20', 30), (2, '2022-09-20', 30)")


cur.execute('DROP TABLE BOOKING_HISTORY;')
cur.execute('''
CREATE TABLE IF NOT EXISTS BOOKING_HISTORY (
    REF_NO INT,
    MOBILE_NO INT NOT NULL,
    NAME_OF_CUSTOMER VARCHAR(25) NOT NULL,
    GENDER VARCHAR(6) NOT NULL,
    AGE INT NOT NULL,
    FARE INT NOT NULL,
    TOTAL_NO_OF_SEATS INT NOT NULL,
    BUSID INT NOT NULL,
    BOOKING_DATE DATE NOT NULL,
    TRAVEL_DATE DATE NOT NULL,
    BOARDING_POINT VARCHAR(15) NOT NULL,
    DESTINATION_POINT VARCHAR(15) NOT NULL,
    PRIMARY KEY(REF_NO, MOBILE_NO)
)''')


#create trigger1

#cur.execute('DROP TRIGGER TRIG_BOOK_HISTORY_INSERT')
cur.execute('''
CREATE TRIGGER TRIG_BOOK_HISTORY_INSERT
AFTER INSERT
ON BOOKING_HISTORY
WHEN NEW.REF_NO IS NULL
BEGIN
UPDATE BOOKING_HISTORY
SET REF_NO = IFNULL((SELECT MAX(REF_NO) FROM BOOKING_HISTORY) + 1, 1)
WHERE REF_NO IS NULL;
END
''')
"""
route3 = [
    (3,1,'Delhi'),
    (3,2,'Agra'),
    (3,3,'Jhansi'),
    (3,4,'Shivpuri'),
    (3,5,'Guna'),
    (3,6,'JP College'),
    (3,7,'Binaganj'),
    (3,8,'Biora'),
    (3,9,'Bhopal')
    ]
route4 = [
    (4,1,'Bhopal'),
    (4,2,'Biora'),
    (4,3,'Binaganj'),
    (4,4,'JP College'),
    (4,5,'Guna'),
    (4,6,'Shivpuri'),
    (4,7,'Jhansi'),
    (4,8,'Agra'),
    (4,9,'Delhi')
    ]

#cur.execute("INSERT INTO ROUTE VALUES (4,1,'Bhopal');")
#cur.executemany("INSERT INTO ROUTE VALUES (?, ?, ?)" , route4)

x=[
    (5, '2022-12-01', 30),
(5, '2022-12-02', 30),
(5, '2022-12-03', 30),
(5, '2022-12-04', 30),
(5, '2022-12-05', 30),
(5, '2022-12-06', 30),
(5, '2022-12-07', 30),
(5, '2022-12-08', 30),
(5, '2022-12-09', 30),
(5, '2022-12-10', 30),
(5, '2022-12-11', 30),
(5, '2022-12-12', 30),
(5, '2022-12-13', 30),
(5, '2022-12-14', 30),
(5, '2022-12-15', 30),
(5, '2022-12-16', 30),
(5, '2022-12-17', 30),
(5, '2022-12-18', 30),
(5, '2022-12-19', 30),
(5, '2022-12-20', 30),
(5, '2022-12-21', 30),
(5, '2022-12-22', 30),
(5, '2022-12-23', 30),
(5, '2022-12-24', 30),
(5, '2022-12-25', 30),
(5, '2022-12-26', 30),
(5, '2022-12-27', 30),
(5, '2022-12-28', 30),
(5, '2022-12-29', 30),
(5, '2022-12-30', 30),
(5, '2022-12-31', 30)
]

runs_dec_2022 = [
    (1, '2022-12-01', 30),    (2, '2022-12-01', 30),    (3, '2022-12-01', 30),    (4, '2022-12-01', 30),
    (1, '2022-12-02', 30),    (2, '2022-12-02', 30),    (3, '2022-12-02', 30),    (4, '2022-12-02', 30),
    (1, '2022-12-03', 30),    (2, '2022-12-03', 30),    (3, '2022-12-03', 30),    (4, '2022-12-03', 30),
    (1, '2022-12-04', 30),    (2, '2022-12-04', 30),    (3, '2022-12-04', 30),    (4, '2022-12-04', 30),
    (1, '2022-12-05', 30),    (2, '2022-12-05', 30),    (3, '2022-12-05', 30),    (4, '2022-12-05', 30),
    (1, '2022-12-06', 30),    (2, '2022-12-06', 30),    (3, '2022-12-06', 30),    (4, '2022-12-06', 30),
    (1, '2022-12-07', 30),    (2, '2022-12-07', 30),    (3, '2022-12-07', 30),    (4, '2022-12-07', 30),
    (1, '2022-12-08', 30),    (2, '2022-12-08', 30),    (3, '2022-12-08', 30),    (4, '2022-12-08', 30),
    (1, '2022-12-09', 30),    (2, '2022-12-09', 30),    (3, '2022-12-09', 30),    (4, '2022-12-09', 30),
    (1, '2022-12-10', 30),    (2, '2022-12-10', 30),    (3, '2022-12-10', 30),    (4, '2022-12-10', 30),
    (1, '2022-12-11', 30),    (2, '2022-12-11', 30),    (3, '2022-12-11', 30),    (4, '2022-12-11', 30),
    (1, '2022-12-12', 30),    (2, '2022-12-12', 30),    (3, '2022-12-12', 30),    (4, '2022-12-12', 30),
    (1, '2022-12-13', 30),    (2, '2022-12-13', 30),    (3, '2022-12-13', 30),    (4, '2022-12-13', 30),
    (1, '2022-12-14', 30),    (2, '2022-12-14', 30),    (3, '2022-12-14', 30),    (4, '2022-12-14', 30),
    (1, '2022-12-15', 30),    (2, '2022-12-15', 30),    (3, '2022-12-15', 30),    (4, '2022-12-15', 30),
    (1, '2022-12-16', 30),    (2, '2022-12-16', 30),    (3, '2022-12-16', 30),    (4, '2022-12-16', 30),
    (1, '2022-12-17', 30),    (2, '2022-12-17', 30),    (3, '2022-12-17', 30),    (4, '2022-12-17', 30),
    (1, '2022-12-18', 30),    (2, '2022-12-18', 30),    (3, '2022-12-18', 30),    (4, '2022-12-18', 30),
    (1, '2022-12-19', 30),    (2, '2022-12-19', 30),    (3, '2022-12-19', 30),    (4, '2022-12-19', 30),
    (1, '2022-12-20', 30),    (2, '2022-12-20', 30),    (3, '2022-12-20', 30),    (4, '2022-12-20', 30),
    (1, '2022-12-21', 30),    (2, '2022-12-21', 30),    (3, '2022-12-21', 30),    (4, '2022-12-21', 30),
    (1, '2022-12-22', 30),    (2, '2022-12-22', 30),    (3, '2022-12-22', 30),    (4, '2022-12-22', 30),
    (1, '2022-12-23', 30),    (2, '2022-12-23', 30),    (3, '2022-12-23', 30),    (4, '2022-12-23', 30),
    (1, '2022-12-24', 30),    (2, '2022-12-24', 30),    (3, '2022-12-24', 30),    (4, '2022-12-24', 30),
    (1, '2022-12-25', 30),    (2, '2022-12-25', 30),    (3, '2022-12-25', 30),    (4, '2022-12-25', 30),
    (1, '2022-12-26', 30),    (2, '2022-12-26', 30),    (3, '2022-12-26', 30),    (4, '2022-12-26', 30),
    (1, '2022-12-27', 30),    (2, '2022-12-27', 30),    (3, '2022-12-27', 30),    (4, '2022-12-27', 30),
    (1, '2022-12-28', 30),    (2, '2022-12-28', 30),    (3, '2022-12-28', 30),    (4, '2022-12-28', 30),
    (1, '2022-12-29', 30),    (2, '2022-12-29', 30),    (3, '2022-12-29', 30),    (4, '2022-12-29', 30),
    (1, '2022-12-30', 30),    (2, '2022-12-30', 30),    (3, '2022-12-30', 30),    (4, '2022-12-30', 30),
    (1, '2022-12-31', 30),    (2, '2022-12-31', 30),    (3, '2022-12-31', 30),    (4, '2022-12-31', 30)
    ]
runs_jan_2023 = [
    (1, '2023-01-01', 30),    (2, '2023-01-01', 30),    (3, '2023-01-01', 30),    (4, '2023-01-01', 30),
    (1, '2023-01-02', 30),    (2, '2023-01-02', 30),    (3, '2023-01-02', 30),    (4, '2023-01-02', 30),
    (1, '2023-01-03', 30),    (2, '2023-01-03', 30),    (3, '2023-01-03', 30),    (4, '2023-01-03', 30),
    (1, '2023-01-04', 30),    (2, '2023-01-04', 30),    (3, '2023-01-04', 30),    (4, '2023-01-04', 30),
    (1, '2023-01-05', 30),    (2, '2023-01-05', 30),    (3, '2023-01-05', 30),    (4, '2023-01-05', 30),
    (1, '2023-01-06', 30),    (2, '2023-01-06', 30),    (3, '2023-01-06', 30),    (4, '2023-01-06', 30),
    (1, '2023-01-07', 30),    (2, '2023-01-07', 30),    (3, '2023-01-07', 30),    (4, '2023-01-07', 30),
    (1, '2023-01-08', 30),    (2, '2023-01-08', 30),    (3, '2023-01-08', 30),    (4, '2023-01-08', 30),
    (1, '2023-01-09', 30),    (2, '2023-01-09', 30),    (3, '2023-01-09', 30),    (4, '2023-01-09', 30),
    (1, '2023-01-10', 30),    (2, '2023-01-10', 30),    (3, '2023-01-10', 30),    (4, '2023-01-10', 30),
    (1, '2023-01-11', 30),    (2, '2023-01-11', 30),    (3, '2023-01-11', 30),    (4, '2023-01-11', 30),
    (1, '2023-01-12', 30),    (2, '2023-01-12', 30),    (3, '2023-01-12', 30),    (4, '2023-01-12', 30),
    (1, '2023-01-13', 30),    (2, '2023-01-13', 30),    (3, '2023-01-13', 30),    (4, '2023-01-13', 30),
    (1, '2023-01-14', 30),    (2, '2023-01-14', 30),    (3, '2023-01-14', 30),    (4, '2023-01-14', 30),
    (1, '2023-01-15', 30),    (2, '2023-01-15', 30),    (3, '2023-01-15', 30),    (4, '2023-01-15', 30),
    (1, '2023-01-16', 30),    (2, '2023-01-16', 30),    (3, '2023-01-16', 30),    (4, '2023-01-16', 30),
    (1, '2023-01-17', 30),    (2, '2023-01-17', 30),    (3, '2023-01-17', 30),    (4, '2023-01-17', 30),
    (1, '2023-01-18', 30),    (2, '2023-01-18', 30),    (3, '2023-01-18', 30),    (4, '2023-01-18', 30),
    (1, '2023-01-19', 30),    (2, '2023-01-19', 30),    (3, '2023-01-19', 30),    (4, '2023-01-19', 30),
    (1, '2023-01-20', 30),    (2, '2023-01-20', 30),    (3, '2023-01-20', 30),    (4, '2023-01-20', 30),
    (1, '2023-01-21', 30),    (2, '2023-01-21', 30),    (3, '2023-01-21', 30),    (4, '2023-01-21', 30),
    (1, '2023-01-22', 30),    (2, '2023-01-22', 30),    (3, '2023-01-22', 30),    (4, '2023-01-22', 30),
    (1, '2023-01-23', 30),    (2, '2023-01-23', 30),    (3, '2023-01-23', 30),    (4, '2023-01-23', 30),
    (1, '2023-01-24', 30),    (2, '2023-01-24', 30),    (3, '2023-01-24', 30),    (4, '2023-01-24', 30),
    (1, '2023-01-25', 30),    (2, '2023-01-25', 30),    (3, '2023-01-25', 30),    (4, '2023-01-25', 30),
    (1, '2023-01-26', 30),    (2, '2023-01-26', 30),    (3, '2023-01-26', 30),    (4, '2023-01-26', 30),
    (1, '2023-01-27', 30),    (2, '2023-01-27', 30),    (3, '2023-01-27', 30),    (4, '2023-01-27', 30),
    (1, '2023-01-28', 30),    (2, '2023-01-28', 30),    (3, '2023-01-28', 30),    (4, '2023-01-28', 30),
    (1, '2023-01-29', 30),    (2, '2023-01-29', 30),    (3, '2023-01-29', 30),    (4, '2023-01-29', 30),
    (1, '2023-01-30', 30),    (2, '2023-01-30', 30),    (3, '2023-01-30', 30),    (4, '2023-01-30', 30),
    (1, '2023-01-31', 30),    (2, '2023-01-31', 30),    (3, '2023-01-31', 30),    (4, '2023-01-31', 30)
    
    ]
#cur.executemany("INSERT INTO RUNS VALUES (?, ?, ?)" , x)
#cur.executemany("INSERT INTO RUNS VALUES (?, ?, ?)" , runs_jan_2023)



#cur.execute("CREATE TABLE IF NOT EXISTS BOOKING_HISTORY (REF_NO INT, MOBILE_NO INT,NAME_OF_CUSTOMER VARCHAR(25),GENDER VARCHAR(6),AGE INT,FARE INT,TOTAL_NO_OF_SEATS INT,BUSID INT,BOOKING_DATE DATE,TRAVEL_DATE DATE,BOARDING_POINT VARCHAR(15),DESTINATION_POINT VARCHAR(15),PRIMARY KEY(MOBILE_NO))")


#cur.execute('DESCRIBE RUNS')


#cur.execute('SELECT * FROM BUS')
print(cur.execute('SELECT * FROM BUS').fetchall())
#cur.execute('SELECT * FROM ROUTE')
print(con.execute('SELECT * FROM ROUTE').fetchall())
cur.execute('SELECT * FROM OPERATOR')
print(cur.fetchall())
cur.execute('SELECT * FROM RUNS')
res = cur.fetchall()
print(res)
print(con.execute('SELECT * FROM BOOKING_HISTORY').fetchall())


'''
res = cur.execute("select * from runs").fetchone()
print(res[1] , type(res[1]))
'''



#create trigger2 not working
"""
#cur.execute('DROP TRIGGER TRIG_BOOK_HISTORY_INSERT1')
cur.execute('''
CREATE TRIGGER TRIG_BOOK_HISTORY_INSERT1
AFTER INSERT
ON BOOKING_HISTORY
FOR EACH ROW
BEGIN
IF()
UPDATE RUNS
SET SEATAVAIL = IFNULL((SELECT MAX(SEATAVAIL) FROM RUNS) - 1, 1);
END
''')
"""
con.commit()
con.close()




#cur.execute("INSERT INTO TEST VALUES (1,'RATNESH'),(2,'ASHUTOSH')")
#cur.execute('SELECT * FROM TEST;')


